openapi: 3.0.3
info:
  title: Translate App API
  version: 1.0.0
  description: |
    REST API for the Translate App backend. All endpoints are served under the `/api` prefix.
    Authentication uses http-only cookies containing JWT access and refresh tokens. Unless
    otherwise stated, responses are JSON objects.
servers:
  - url: /api
tags:
  - name: Auth
    description: Session-based authentication endpoints.
  - name: Translation
    description: Text translation operations.
  - name: Languages
    description: Language metadata queries.
  - name: Users
    description: Authenticated user profile and translation history endpoints.
paths:
  /auth:
    post:
      tags: [Auth]
      summary: Verify the current user session
      description: |
        Validates the `accessToken` cookie and returns the authenticated user's profile.
      responses:
        '200':
          description: User is authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthSuccessResponse'
              examples:
                default:
                  value:
                    status: success
                    email: jane.doe@example.com
                    firstName: Jane
                    lastName: Doe
                    phone: '+14155550123'
                    isAuthenticated: true
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/ServerError'
      security:
        - cookieAuth: []
  /auth/login:
    post:
      tags: [Auth]
      summary: Log in a user
      description: Authenticates a user with email and password. On success, http-only cookies for `accessToken` and `refreshToken` are set.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              default:
                value:
                  email: jane.doe@example.com
                  password: Str0ngP@ss!
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthSuccessResponse'
        '400':
          description: Invalid payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
              examples:
                invalidPassword:
                  value:
                    status: error
                    errType: SchemaValidationErr
                    errors:
                      - field: ["password"]
                        code: too_small
                        message: Password must be at least 8 characters long
                    message: Incorrect schema in request body
        '401':
          description: Authentication failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginUnauthorizedResponse'
        '500':
          $ref: '#/components/responses/ServerError'
  /auth/register:
    post:
      tags: [Auth]
      summary: Register a new user
      description: Creates a new user account and sends a verification email.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            examples:
              default:
                value:
                  email: jane.doe@example.com
                  password: Str0ngP@ss!
                  phone: '+14155550123'
                  firstName: Jane
                  lastName: Doe
      responses:
        '200':
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterSuccessResponse'
        '400':
          description: Validation error or duplicate email
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ValidationErrorResponse'
                  - $ref: '#/components/schemas/DuplicateEmailResponse'
        '500':
          $ref: '#/components/responses/ServerError'
  /auth/verify/{token}:
    get:
      tags: [Auth]
      summary: Verify a user's email address
      description: Confirms a user's email address using the verification token that was emailed to them.
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
          description: JWT email verification token sent to the user.
      responses:
        '200':
          description: Email verification succeeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerificationSuccessResponse'
        '400':
          description: Invalid token or user not found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/VerificationErrorResponse'
                  - $ref: '#/components/schemas/InvalidTokenErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'
  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh the access token
      description: Issues a new access token using the `refreshToken` cookie.
      responses:
        '200':
          description: Access token refreshed
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                required: [status]
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/ServerError'
      security:
        - refreshCookieAuth: []
  /auth/logout:
    get:
      tags: [Auth]
      summary: Log out the current user
      description: Clears authentication cookies.
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                required: [status]
        '500':
          $ref: '#/components/responses/ServerError'
  /translate:
    post:
      tags: [Translation]
      summary: Translate text
      description: Translates the provided text using Azure Cognitive Services. Requires an authenticated session.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TranslateRequest'
            examples:
              default:
                value:
                  from: en
                  to: es
                  text: "Hello world"
      responses:
        '200':
          description: Translation succeeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TranslateSuccessResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TranslateBadRequestResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/ServerError'
  /languages:
    get:
      tags: [Languages]
      summary: List supported languages
      description: Retrieves all languages supported by the upstream translation provider.
      responses:
        '200':
          description: Supported languages fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LanguagesResponse'
        '500':
          $ref: '#/components/responses/ServerError'
  /languages/{language}:
    get:
      tags: [Languages]
      summary: Get a language's translation code
      description: Returns the ISO code for the given language name.
      parameters:
        - name: language
          in: path
          required: true
          schema:
            type: string
          description: Human-readable language name (case insensitive).
          example: "English"
      responses:
        '200':
          description: Language code resolved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LanguageCodeResponse'
        '400':
          description: Invalid language name
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'
  /users/{userEmail}:
    get:
      tags: [Users]
      summary: Get the current user's profile
      description: Returns non-sensitive profile details for the authenticated user matching `userEmail`.
      security:
        - cookieAuth: []
      parameters:
        - name: userEmail
          in: path
          required: true
          schema:
            type: string
            format: email
            example: jane.doe@example.com
          description: Email address for the authenticated user.
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileResponse'
              examples:
                default:
                  value:
                    status: success
                    data:
                      email: jane.doe@example.com
                      firstName: Jane
                      lastName: Doe
                      phone: '+14155550123'
                      isVerified: true
                      createdAt: '2025-01-15T12:34:56.000Z'
        '400':
          description: Invalid email parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/UserNotFoundError'
        '500':
          $ref: '#/components/responses/ServerError'
  /users/{userEmail}/translations:
    get:
      tags: [Users]
      summary: List user translations
      description: Returns a paginated list of translations created by the authenticated user.
      security:
        - cookieAuth: []
      parameters:
        - name: userEmail
          in: path
          required: true
          schema:
            type: string
            format: email
            example: jane.doe@example.com
          description: Email address for the authenticated user.
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 2
          description: Page number to retrieve.
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
            example: 5
          description: Number of translations per page.
      responses:
        '200':
          description: Translations fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserTranslationsResponse'
              examples:
                default:
                  value:
                    status: success
                    data:
                      - _id: '66a1b2c3d4e5f60718293abc'
                        user: '507f191e810c19729de860ea'
                        sourceText: 'Hello world'
                        translatedText: 'Hola mundo'
                        from: en
                        to: es
                        createdAt: '2025-01-15T12:30:00.000Z'
                        updatedAt: '2025-01-15T12:30:00.000Z'
                      - _id: '66a1b2c3d4e5f60718293abd'
                        user: '507f191e810c19729de860ea'
                        sourceText: 'How are you?'
                        translatedText: '¿Cómo estás?'
                        from: en
                        to: es
                        createdAt: '2025-01-15T12:31:00.000Z'
                        updatedAt: '2025-01-15T12:31:00.000Z'
                    meta:
                      page: 2
                      limit: 5
                      total: 12
                      pages: 3
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/UserNotFoundError'
        '500':
          $ref: '#/components/responses/ServerError'
  /users/{userEmail}/translations/search:
    post:
      tags: [Users]
      summary: Search user translations
      description: Filters the authenticated user's translations using optional language or text criteria.
      security:
        - cookieAuth: []
      parameters:
        - name: userEmail
          in: path
          required: true
          schema:
            type: string
            format: email
            example: jane.doe@example.com
          description: Email address for the authenticated user.
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
          description: Page number to retrieve.
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
            example: 10
          description: Number of translations per page.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserTranslationSearchRequest'
            examples:
              default:
                value:
                  from: en
                  to: es
                  sourceText: hello
                  translatedText: hola
              partial-match:
                value:
                  sourceText: hel
                  translatedText: hola
      responses:
        '200':
          description: Filtered translations fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserTranslationsResponse'
              examples:
                default:
                  value:
                    status: success
                    data:
                      - _id: '66a1b2c3d4e5f60718293abe'
                        user: '507f191e810c19729de860ea'
                        sourceText: 'Hello there'
                        translatedText: 'Hola allí'
                        from: en
                        to: es
                        createdAt: '2025-01-15T12:40:00.000Z'
                        updatedAt: '2025-01-15T12:40:00.000Z'
                    meta:
                      page: 1
                      limit: 10
                      total: 1
                      pages: 1
        '400':
          description: Invalid search criteria
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/UserNotFoundError'
        '500':
          $ref: '#/components/responses/ServerError'
components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: accessToken
    refreshCookieAuth:
      type: apiKey
      in: cookie
      name: refreshToken
  schemas:
    AuthSuccessResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success]
        email:
          type: string
          format: email
        firstName:
          type: string
        lastName:
          type: string
        phone:
          type: string
        isAuthenticated:
          type: boolean
      required: [status, email, firstName, lastName, phone, isAuthenticated]
    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 8
      required: [email, password]
    RegisterRequest:
      allOf:
        - $ref: '#/components/schemas/LoginRequest'
        - type: object
          properties:
            phone:
              type: string
              example: '+14155550123'
            firstName:
              type: string
            lastName:
              type: string
          required: [phone, firstName, lastName]
    RegisterSuccessResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success]
        message:
          type: string
      required: [status, message]
      example:
        status: success
        message: Sent Email Verification
    DuplicateEmailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [error]
        errType:
          type: string
          enum: [RegistrationError]
        userExists:
          type: boolean
        desc:
          type: string
      required: [status, errType, userExists, desc]
      example:
        status: error
        errType: RegistrationError
        userExists: true
        desc: Email already in use
    VerificationSuccessResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success]
        userExists:
          type: boolean
        isVerified:
          type: boolean
      required: [status, userExists, isVerified]
    VerificationErrorResponse:
      type: object
      properties:
        status:
          type: string
          enum: [error]
        errType:
          type: string
          enum: [VerificationError]
        userExists:
          type: boolean
        isVerified:
          type: boolean
        desc:
          type: string
      required: [status, errType, userExists, isVerified, desc]
    InvalidTokenErrorResponse:
      type: object
      properties:
        status:
          type: string
          enum: [error]
        errType:
          type: string
          enum: [InvalidTokenError]
        desc:
          type: string
      required: [status, errType, desc]
    LoginUnauthorizedResponse:
      type: object
      properties:
        status:
          type: string
          enum: [error]
        errType:
          type: string
          enum: [UnauthorizedError]
        userExists:
          type: boolean
        isAuthenticated:
          type: boolean
        desc:
          type: string
      required: [status, errType]
    ValidationErrorResponse:
      type: object
      properties:
        status:
          type: string
          enum: [error]
        errType:
          type: string
          enum: [SchemaValidationErr]
        errors:
          type: array
          items:
            type: object
            properties:
              field:
                type: array
                items:
                  type: string
              code:
                type: string
              message:
                type: string
            required: [field, code, message]
        message:
          type: string
      required: [status, errType, errors, message]
    TranslateRequest:
      type: object
      properties:
        from:
          type: string
          description: Optional language code for the source text.
          example: en
        to:
          type: string
          description: Target language code.
          example: es
        text:
          type: string
          description: Text to translate.
          example: Hello world
      required: [to, text]
    TranslateSuccessResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success]
        sourceText:
          type: string
        translatedText:
          type: string
        from:
          type: string
        to:
          type: string
      required: [status, sourceText, translatedText, to]
      example:
        status: success
        sourceText: Hello world
        translatedText: Hola mundo
        from: en
        to: es
    TranslateBadRequestResponse:
      type: object
      properties:
        status:
          type: string
          enum: [error]
        errType:
          type: string
          enum: [BadRequestError]
        desc:
          type: string
      required: [status, errType, desc]
    LanguagesResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success]
        supportedLanguages:
          type: object
          additionalProperties:
            type: object
            properties:
              name:
                type: string
              nativeName:
                type: string
              dir:
                type: string
                enum: [ltr, rtl]
            required: [name, nativeName, dir]
      required: [status, supportedLanguages]
    LanguageCodeResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success]
        code:
          type: string
      required: [status, code]
    UserProfile:
      type: object
      properties:
        email:
          type: string
          format: email
        firstName:
          type: string
        lastName:
          type: string
        phone:
          type: string
          nullable: true
        isVerified:
          type: boolean
        createdAt:
          type: string
          format: date-time
      required: [email, firstName, lastName, isVerified, createdAt]
    UserProfileResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success]
        data:
          $ref: '#/components/schemas/UserProfile'
      required: [status, data]
      example:
        status: success
        data:
          email: jane.doe@example.com
          firstName: Jane
          lastName: Doe
          phone: '+14155550123'
          isVerified: true
          createdAt: '2024-05-01T15:30:00.000Z'
    TranslationResource:
      type: object
      properties:
        _id:
          type: string
          description: Translation identifier.
          example: 6651234abcdeff0987654321
        user:
          type: string
          description: Owning user's identifier.
        sourceText:
          type: string
        translatedText:
          type: string
        from:
          type: string
        to:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [_id, user, sourceText, translatedText, from, to, createdAt, updatedAt]
    UserTranslationsResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success]
        data:
          type: array
          items:
            $ref: '#/components/schemas/TranslationResource'
        meta:
          type: object
          properties:
            page:
              type: integer
            limit:
              type: integer
            total:
              type: integer
            pages:
              type: integer
          required: [page, limit, total, pages]
      required: [status, data, meta]
    UserTranslationSearchRequest:
      type: object
      properties:
        from:
          type: string
          description: Filter translations by source language code.
        to:
          type: string
          description: Filter translations by target language code.
        sourceText:
          type: string
          minLength: 5
          maxLength: 100
          description: Filter translations containing this source text (case insensitive substring match).
        translatedText:
          type: string
          minLength: 5
          maxLength: 100
          description: Filter translations containing this translated text (case insensitive substring match).
      additionalProperties: false
    UserNotFoundError:
      type: object
      properties:
        status:
          type: string
          enum: [error]
        errType:
          type: string
          enum: [UserNotFoundError]
        desc:
          type: string
      required: [status, errType, desc]
    ForbiddenError:
      type: object
      properties:
        status:
          type: string
          enum: [error]
        errType:
          type: string
          enum: [ForbiddenError]
      required: [status, errType]
  responses:
    UnauthorizedError:
      description: Missing or invalid authentication token
      content:
        application/json:
          schema:
            type: object
            properties:
              status:
                type: string
                enum: [error]
              errType:
                type: string
                enum: [UnauthorizedError]
              desc:
                type: string
            required: [status, errType]
    ServerError:
      description: Unexpected server error
      content:
        application/json:
          schema:
            type: object
            properties:
              status:
                type: string
                enum: [error]
              errType:
                type: string
                enum: [ServerError]
              desc:
                type: string
            required: [status, errType]
    ForbiddenError:
      description: Authenticated user lacks permission to access the requested resource
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ForbiddenError'
    UserNotFoundError:
      description: The specified user could not be found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/UserNotFoundError'
